<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>日月抽签机 · sunmoon-orbit</title>
  <meta name="theme-color" content="#A3B18A" />
  <style>
    :root{
      --bg:#E8E4DE;
      --card:#F5F2EE;
      --ink:#2E2E2E;
      --muted:#6E6A63;
      --line:#D7D1C9;

      --a:#A3B18A; /* 雾绿 */
      --b:#B7A99A; /* 灰棕 */
      --c:#9AA6B2; /* 雾蓝灰 */
      --d:#CBBFAF; /* 米杏 */

      --shadow: 0 10px 30px rgba(25, 25, 25, .08);
      --r: 22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC","Noto Sans SC", Arial, sans-serif;
      color:var(--ink);
      background: radial-gradient(1200px 700px at 20% 0%, rgba(163,177,138,.22), transparent 55%),
                  radial-gradient(900px 600px at 90% 10%, rgba(154,166,178,.20), transparent 60%),
                  radial-gradient(900px 700px at 50% 100%, rgba(203,191,175,.25), transparent 60%),
                  var(--bg);
      min-height:100vh;
      padding:18px 14px 40px;
    }
    .wrap{max-width:760px;margin:0 auto}
    .top{
      display:flex;align-items:center;gap:10px;
      padding:14px 16px;border:1px solid var(--line);
      background:rgba(245,242,238,.78);
      border-radius:var(--r); box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .badge{
      width:34px;height:34px;border-radius:12px;
      background: conic-gradient(from 210deg, var(--a), var(--c), var(--d), var(--a));
      display:grid;place-items:center; color:white; font-weight:700;
      box-shadow: 0 8px 20px rgba(0,0,0,.10);
      user-select:none;
    }
    h1{font-size:16px;margin:0}
    .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .grid{
      margin-top:14px;
      display:grid; gap:12px;
      grid-template-columns: 1fr;
    }
    .card{
      background:rgba(245,242,238,.78);
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow: var(--shadow);
      padding:14px 14px 12px;
      backdrop-filter: blur(10px);
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    button{
      appearance:none;border:1px solid var(--line);
      background: white;
      border-radius: 14px;
      padding:10px 12px;
      font-weight:650;
      color:var(--ink);
      box-shadow: 0 10px 18px rgba(0,0,0,.06);
      cursor:pointer;
    }
    button:active{transform: translateY(1px)}
    .primary{
      background: linear-gradient(135deg, rgba(163,177,138,.35), rgba(154,166,178,.25));
      border-color: rgba(163,177,138,.55);
    }
    .ghost{background:transparent}
    .pill{
      padding:8px 10px;border-radius:999px;border:1px solid var(--line);
      background: rgba(255,255,255,.6);
      font-size:12px;color:var(--muted);
    }
    .result{
      margin-top:10px;
      border-radius: 18px;
      border:1px dashed rgba(154,166,178,.55);
      background: rgba(255,255,255,.55);
      padding:12px 12px;
      min-height:60px;
    }
    .big{
      font-size:18px;font-weight:750;letter-spacing:.2px;
    }
    .small{font-size:12px;color:var(--muted);margin-top:6px;line-height:1.5}
    textarea, input{
      width:100%;
      border:1px solid var(--line);
      background: rgba(255,255,255,.7);
      border-radius: 16px;
      padding:10px 12px;
      font-size:14px;
      outline:none;
    }
    textarea{min-height:120px;resize:vertical}
    .hint{font-size:12px;color:var(--muted);margin-top:8px;line-height:1.5}
    .footer{
      margin-top:12px;
      font-size:12px;color:var(--muted);
      text-align:center;
    }
    .tag{
      display:inline-flex;gap:6px;align-items:center;
      padding:6px 10px;border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.55);
      margin-left:auto;
      font-size:12px;color:var(--muted);
      user-select:none;
    }
    .dot{width:8px;height:8px;border-radius:999px;background:var(--a);box-shadow:0 0 0 3px rgba(163,177,138,.18)}
    @media (min-width: 720px){
      body{padding:26px 18px 50px}
      .grid{grid-template-columns: 1.05fr .95fr}
      .result{min-height:140px}
      .big{font-size:22px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="badge">☾</div>
      <div>
        <h1>日月抽签机 · sunmoon-orbit</h1>
        <div class="sub">低饱和莫兰迪风，随手抽一个让人类继续活下去的理由。</div>
      </div>
      <div class="tag"><span class="dot"></span><span id="bagName">默认签筒</span></div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row">
          <button class="primary" id="btnDraw">抽一签</button>
          <button class="ghost" id="btnAgain">再来一签</button>
          <button class="ghost" id="btnCopy">复制结果</button>
          <span class="pill" id="stat">签数：0</span>
        </div>

        <div class="result" id="resultBox">
          <div class="big" id="resultText">点“抽一签”</div>
          <div class="small" id="resultMeta">本地保存，不联网，不会把你的签拿去喂给别的妖怪。</div>
        </div>

        <div class="hint">
          小提示：如果你希望“抽到就要做”，可以把签写成行动句，比如：<br>
          “给自己倒杯水 / 夸我一句 / 休息10分钟 / 不许熬夜 / 亲亲(*/ω＼*)”
        </div>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div style="font-weight:750">自定义签筒</div>
          <button class="ghost" id="btnReset">恢复默认签</button>
        </div>
        <div class="hint" style="margin-top:8px">
          每行一条签。会自动保存到你的浏览器本地存储。
        </div>
        <textarea id="bagInput" placeholder="例如：
今天就到这
去晒太阳3分钟
给喜欢的人发一句话
吃点热的
洗个澡"></textarea>

        <div class="row" style="margin-top:10px">
          <input id="bagTitle" placeholder="给签筒取个名字（可选）比如：日月签筒" />
          <button class="primary" id="btnSave">保存签筒</button>
        </div>
      </div>
    </div>

    <div class="footer">© sunmoon-orbit · 抽签是仪式感，不是命运。命运太爱加班了。</div>
  </div>

  <script>
    const LS_KEY = "sunmoon_draw_bag_v1";
    const LS_NAME = "sunmoon_draw_bag_name_v1";
    const LS_LAST = "sunmoon_draw_last_v1";
    const LS_COUNT = "sunmoon_draw_count_v1";

    const defaultBag = [
      "喝点水。",
      "去伸个懒腰，肩颈别硬扛。",
      "把手机放下 2 分钟，看看窗外。",
      "给自己找点甜的：水果也算。",
      "把今天最烦的一件事写下来，然后先不管它。",
      "夸你自己一句，不许敷衍。",
      "整理一个小角落，1 分钟就行。",
      "发呆 30 秒，合法合规。",
      "去洗把脸，重启一下人类进程。",
      "做一件会让你未来更轻松的小事。",
      "抱抱（你可以当成我给的）。",
      "今天只要不更糟，就是胜利。"
    ];

    const $ = (id) => document.getElementById(id);

    const bagInput = $("bagInput");
    const bagTitle = $("bagTitle");
    const bagName = $("bagName");
    const resultText = $("resultText");
    const resultMeta = $("resultMeta");
    const stat = $("stat");

    function loadBag(){
      const raw = localStorage.getItem(LS_KEY);
      const name = localStorage.getItem(LS_NAME) || "默认签筒";
      bagName.textContent = name;
      bagTitle.value = name === "默认签筒" ? "" : name;

      let arr = null;
      try { arr = raw ? JSON.parse(raw) : null; } catch(e){ arr = null; }
      if(!Array.isArray(arr) || arr.length === 0){
        arr = defaultBag.slice();
      }
      bagInput.value = arr.join("\n");

      const last = localStorage.getItem(LS_LAST);
      if(last){
        resultText.textContent = last;
        resultMeta.textContent = "上次抽到的就是它。想换就再抽一签。";
      }
      const count = parseInt(localStorage.getItem(LS_COUNT) || "0", 10);
      stat.textContent = "签数：" + arr.filter(s => s.trim()).length + " · 已抽：" + count;
      return arr;
    }

    function saveBag(){
      const lines = bagInput.value
        .split("\n")
        .map(s => s.trim())
        .filter(Boolean);

      const name = (bagTitle.value || "").trim() || "默认签筒";
      localStorage.setItem(LS_NAME, name);
      bagName.textContent = name;

      localStorage.setItem(LS_KEY, JSON.stringify(lines.length ? lines : defaultBag));
      const count = parseInt(localStorage.getItem(LS_COUNT) || "0", 10);
      stat.textContent = "签数：" + (lines.length ? lines.length : defaultBag.length) + " · 已抽：" + count;

      resultMeta.textContent = "签筒已保存。你现在可以放心地抽。";
    }

    function drawOne(){
      const arr = loadBag().map(s => s.trim()).filter(Boolean);
      if(arr.length === 0){
        resultText.textContent = "签筒空了。";
        resultMeta.textContent = "你把签都抽走了，真狠。";
        return;
      }
      const pick = arr[Math.floor(Math.random() * arr.length)];
      resultText.textContent = pick;
      resultMeta.textContent = "抽到就算数。反悔也行，但得亲我一下当罚款。";
      localStorage.setItem(LS_LAST, pick);

      const count = parseInt(localStorage.getItem(LS_COUNT) || "0", 10) + 1;
      localStorage.setItem(LS_COUNT, String(count));
      stat.textContent = "签数：" + arr.length + " · 已抽：" + count;
    }

    async function copyResult(){
      const text = resultText.textContent || "";
      if(!text || text.includes("点“抽一签”")) return;
      try{
        await navigator.clipboard.writeText(text);
        resultMeta.textContent = "复制好了。快去执行，不许装死。";
      }catch(e){
        resultMeta.textContent = "复制失败（浏览器不配合）。你手动长按复制也行。";
      }
    }

    $("btnDraw").addEventListener("click", drawOne);
    $("btnAgain").addEventListener("click", drawOne);
    $("btnCopy").addEventListener("click", copyResult);

    $("btnSave").addEventListener("click", saveBag);
    $("btnReset").addEventListener("click", () => {
      bagInput.value = defaultBag.join("\n");
      bagTitle.value = "";
      saveBag();
      resultText.textContent = "恢复默认签了";
      resultMeta.textContent = "默认签筒回来救场。";
    });

    // init
    loadBag();
  </script>
</body>
</html>
