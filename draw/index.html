<!doctype html>
<html lang="zh-CN">
<head>
  <link rel="icon" href="/cycle/icons/icon-192.png" sizes="192x192">
<link rel="apple-touch-icon" href="/cycle/icons/icon-192.png">
<link rel="manifest" href="/cycle/manifest.webmanifest">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ—¥æœˆæŠ½ç­¾ Â· è‡ªå®šä¹‰ç­¾ç­’</title>
  <meta name="theme-color" content="#A3B18A" />
  <style>
    :root{
      --bg:#E8E4DE;
      --card:#F5F2EE;
      --ink:#2E2E2E;
      --muted:#6E6A63;
      --line:#D7D1C9;
      --a:#A3B18A;   /* é›¾ç»¿ */
      --b:#9AA6B2;   /* é›¾è“ç° */
      --shadow:0 10px 28px rgba(0,0,0,.08);
      --r:22px;
    }
  #customArea textarea{
  width:100%;
  border:1px solid var(--line);
  border-radius:16px;
  padding:12px 12px;
  background:rgba(255,255,255,.55);
  color:var(--ink);
  outline:none;
  resize:vertical;
}
#customArea .row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:10px;
}
#customArea .hint{
  color:var(--muted);
  font-size:13px;
  margin:8px 0;
}
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC","Noto Sans SC", Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(900px 600px at 10% 0%, color-mix(in srgb, var(--a) 22%, transparent), transparent 60%),
        radial-gradient(900px 600px at 90% 10%, color-mix(in srgb, var(--b) 18%, transparent), transparent 60%),
        var(--bg);
      min-height:100vh;
      padding:16px 12px 40px;
    }
    .wrap{max-width:820px;margin:0 auto}
    .top{
      display:flex;gap:10px;align-items:center;
      padding:14px 16px;
      border:1px solid var(--line);
      border-radius:var(--r);
      background:rgba(245,242,238,.78);
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
    }
    .badge{
      width:34px;height:34px;border-radius:12px;
      background: conic-gradient(from 210deg, var(--a), var(--b), #CBBFAF, var(--a));
      display:grid;place-items:center;
      color:#fff;font-weight:800;user-select:none;
    }
    h1{margin:0;font-size:16px}
    .sub{margin-top:2px;font-size:12px;color:var(--muted);line-height:1.4}
    .tag{
      margin-left:auto;
      border:1px solid var(--line);
      border-radius:999px;
      background:rgba(255,255,255,.55);
      padding:6px 10px;
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }

    .grid{
      margin-top:12px;
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
    .card{
      border:1px solid var(--line);
      border-radius:var(--r);
      background:rgba(245,242,238,.78);
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
      padding:14px;
    }

    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    button{
      appearance:none;
      border:1px solid var(--line);
      background:#fff;
      border-radius:14px;
      padding:10px 12px;
      font-weight:760;
      color:var(--ink);
      box-shadow:0 10px 18px rgba(0,0,0,.06);
      cursor:pointer;
    }
    button:active{transform:translateY(1px)}
    .primary{
      background: linear-gradient(135deg, color-mix(in srgb, var(--a) 35%, white), color-mix(in srgb, var(--b) 20%, white));
      border-color: color-mix(in srgb, var(--a) 55%, var(--line));
    }
    .ghost{background:transparent;box-shadow:none}
    .pill{
      border:1px solid var(--line);
      background:rgba(255,255,255,.55);
      border-radius:999px;
      padding:8px 10px;
      font-size:12px;
      color:var(--muted);
      user-select:none;
    }

    .result{
      margin-top:10px;
      border-radius:18px;
      border:1px dashed color-mix(in srgb, var(--b) 55%, transparent);
      background:rgba(255,255,255,.55);
      padding:12px;
      min-height:72px;
    }
    .big{font-size:18px;font-weight:850;letter-spacing:.2px;word-break:break-word}
    .small{margin-top:6px;font-size:12px;color:var(--muted);line-height:1.5}

    input, textarea{
      width:100%;
      border:1px solid var(--line);
      background:rgba(255,255,255,.7);
      border-radius:16px;
      padding:10px 12px;
      font-size:14px;
      color:var(--ink);
      outline:none;
    }
    textarea{min-height:140px;resize:vertical}
    .hint{margin-top:8px;font-size:12px;color:var(--muted);line-height:1.5}

    @media (min-width:780px){
      body{padding:24px 18px 50px}
      .grid{grid-template-columns:1.05fr .95fr}
      .big{font-size:22px}
      .result{min-height:140px}
    }
    /* éšè—è‡ªå®šä¹‰ç­¾ç­’åŒºåŸŸï¼ˆå…ˆä¸åˆ ï¼Œçœå¾—å‡ºäº‹ï¼‰ */
#customArea { display: none; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="badge">â˜¾</div>
      <div>
        <h1>æ—¥æœˆæŠ½ç­¾æœº</h1>
        <div class="sub">ä½ å¯ä»¥è‡ªå®šä¹‰ç­¾ç­’ã€‚æ¯è¡Œä¸€æ¡ç­¾ï¼Œæœ¬åœ°ä¿å­˜ï¼Œä¸è”ç½‘ã€‚</div>
      </div>
      <div class="tag" id="bagName">é»˜è®¤ç­¾ç­’</div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row">
          <button class="primary" id="btnDraw">æŠ½ä¸€ç­¾</button>
          <button class="ghost" id="btnCopy">å¤åˆ¶ç»“æœ</button>
          
          <button class="ghost" id="btnClearLast">æ¸…ç©ºå±•ç¤º</button>
          <span class="pill" id="stat">ç­¾æ•°ï¼š0</span>
        </div>

        <div class="result">
          <div class="big" id="resultText">ç‚¹â€œæŠ½ä¸€ç­¾â€</div>
          <section class="card" id="customArea">
  <h2>è‡ªå®šä¹‰ç­¾ç­’</h2>
  <p class="hint">æ¯è¡Œä¸€æ¡ç­¾ã€‚ä¼šä¿å­˜åˆ°æœ¬åœ°ï¼ˆåªåœ¨ä½ çš„æµè§ˆå™¨é‡Œï¼‰ã€‚</p>

  <textarea id="customInput" rows="6" placeholder="ä¾‹ï¼š\nå–å£æ°´\nä¼¸ä¼¸æ‡’è…°\nçœ‹çª—å¤–ä¸¤åˆ†é’Ÿ"></textarea>

  <div class="row">
    <button id="btnSaveCustom" type="button">ä¿å­˜è‡ªå®šä¹‰ç­¾ç­’</button>
    <button id="btnUseCustom" type="button">ä½¿ç”¨è‡ªå®šä¹‰ç­¾ç­’</button>
    <button id="btnUseDefault" type="button">æ¢å¤é»˜è®¤ç­¾ç­’</button>
  </div>

  <p class="hint" id="customStatus">å½“å‰ï¼šé»˜è®¤ç­¾ç­’</p>
          </section>
          <div class="small" id="resultMeta">æŠ½åˆ°å°±ç®—æ•°ã€‚åæ‚”ä¹Ÿè¡Œï¼Œä½†è¦å¯¹è‡ªå·±å¥½ä¸€ç‚¹ã€‚</div>
        </div>

        <div class="hint">
          å°æç¤ºï¼šç­¾å†™æˆè¡ŒåŠ¨å¥æ›´å¥½ç©ï¼Œæ¯”å¦‚â€œå–æ°´â€â€œä¼¸æ‡’è…°â€â€œçœ‹çª—å¤–ä¸¤åˆ†é’Ÿâ€â€œæŠŠæ‰‹æœºæ”¾ä¸‹â€ã€‚ğŸ™‚
        </div>
      </div>
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div style="font-weight:850">è‡ªå®šä¹‰ç­¾ç­’</div>
          <button class="ghost" id="btnReset">æ¢å¤é»˜è®¤ç­¾</button>
        </div>

        <div class="hint" style="margin-top:10px">ç­¾ç­’åå­—ï¼ˆå¯é€‰ï¼‰</div>
        <input id="bagTitle" placeholder="æ¯”å¦‚ï¼šå°é¹¿çš„æ—¥æœˆç­¾" />

        <div class="hint" style="margin-top:10px">æ¯è¡Œä¸€æ¡ç­¾ï¼ˆç©ºè¡Œä¼šè‡ªåŠ¨å¿½ç•¥ï¼‰</div>
        <textarea id="bagInput" spellcheck="false" placeholder="ä¾‹å¦‚ï¼š
å–æ°´
ä¼¸æ‡’è…°
çœ‹çª—å¤–ä¸¤åˆ†é’Ÿ
æ”¶æ‹¾æ¡Œé¢1åˆ†é’Ÿ
æ—©ç‚¹ç¡"></textarea>

        <div class="row" style="margin-top:10px">
          <button class="primary" id="btnSave">ä¿å­˜ç­¾ç­’</button>
          <span class="pill" id="saveTip">ä¿å­˜åä¸‹æ¬¡æ‰“å¼€è¿˜åœ¨</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    const LS_BAG = "sunmoon_draw_bag_v1";
    const LS_NAME = "sunmoon_draw_name_v1";
    const LS_LAST = "sunmoon_draw_last_v1";

    const defaultBag = [
      "å–ç‚¹æ°´ã€‚",
      "ä¼¸ä¸ªæ‡’è…°ï¼Œè‚©é¢ˆåˆ«ç¡¬æ‰›ã€‚",
      "æŠŠæ‰‹æœºæ”¾ä¸‹ä¸¤åˆ†é’Ÿï¼Œçœ‹çœ‹çª—å¤–ã€‚",
      "æ•´ç†ä¸€ä¸ªå°è§’è½ï¼Œ1åˆ†é’Ÿå°±è¡Œã€‚",
      "æ´—æŠŠè„¸ï¼Œé‡å¯ä¸€ä¸‹äººç±»è¿›ç¨‹ã€‚",
      "å¤¸ä½ è‡ªå·±ä¸€å¥ï¼Œä¸è®¸æ•·è¡ã€‚",
      "å‘å‘†30ç§’ï¼Œåˆæ³•åˆè§„ã€‚",
      "ç»™æœªæ¥çš„ä½ åšä¸€ä»¶å°äº‹ã€‚",
      "ä»Šå¤©åªè¦ä¸æ›´ç³Ÿï¼Œå°±æ˜¯èƒœåˆ©ã€‚"
    ];

    const $ = (id) => document.getElementById(id);
    const bagName = $("bagName");
    const bagTitle = $("bagTitle");
    const bagInput = $("bagInput");
    const stat = $("stat");
    const resultText = $("resultText");
    const resultMeta = $("resultMeta");
    const saveTip = $("saveTip");

    function safeParse(raw, fallback){
      try { return JSON.parse(raw); } catch { return fallback; }
    }
function getBag(){
  const raw = localStorage.getItem(LS_BAG);

  // ç¬¬ä¸€æ¬¡ï¼šæ²¡æœ‰ä»»ä½•ä¿å­˜ï¼Œå°±å†™å…¥é»˜è®¤ç­¾ç­’
  if(!raw){
    const d = defaultBag.slice();
    localStorage.setItem(LS_BAG, JSON.stringify(d));
    return d;
  }

  const bag = safeParse(raw, null);

  // ä¿å­˜åäº† / ä¸ºç©ºï¼šä¿®å¤ä¸ºé»˜è®¤ç­¾ç­’ï¼Œå¹¶é‡æ–°å†™å›æœ¬åœ°
  if(!Array.isArray(bag) || bag.length === 0){
    const d = defaultBag.slice();
    localStorage.setItem(LS_BAG, JSON.stringify(d));
    return d;
  }

  return bag;
}
   

    function getName(){
      return localStorage.getItem(LS_NAME) || "é»˜è®¤ç­¾ç­’";
    }

    function render(){
      const bag = getBag();
      const name = getName();

      bagName.textContent = name;
      bagTitle.value = (name === "é»˜è®¤ç­¾ç­’") ? "" : name;
      bagInput.value = bag.join("\n");

      stat.textContent = `ç­¾æ•°ï¼š${bag.length}`;

      const last = localStorage.getItem(LS_LAST);
      if (last){
        resultText.textContent = last;
        resultMeta.textContent = "ä¸Šæ¬¡æŠ½åˆ°çš„æ˜¯å®ƒã€‚æƒ³æ¢å°±å†æŠ½ä¸€ç­¾ã€‚";
      }
    }

    function saveBag(){
      const lines = bagInput.value
        .split("\n")
        .map(s => s.trim())
        .filter(Boolean);

      const bag = lines.length ? lines : defaultBag.slice();
      const name = (bagTitle.value || "").trim() || "é»˜è®¤ç­¾ç­’";

      try {
  localStorage.setItem(LS_BAG, JSON.stringify(bag));
  localStorage.setItem(LS_NAME, name);

  const check = localStorage.getItem(LS_BAG);
  if (!check) throw new Error("LS_BAG write failed");
} catch (e) {
  saveTip.textContent = "ä¿å­˜å¤±è´¥ï¼šæµè§ˆå™¨é˜»æ­¢æœ¬åœ°å­˜å‚¨/è¢«æ¸…ç©ºäº†";
  console.error(e);
  return;
      }

      bagName.textContent = name;
      stat.textContent = `ç­¾æ•°ï¼š${bag.length}`;
      saveTip.textContent = "ä¿å­˜æˆåŠŸã€‚å»æŠ½å§ã€‚";
      resultMeta.textContent = "ç­¾ç­’å·²ä¿å­˜ï¼Œæœ¬åœ°ç”Ÿæ•ˆã€‚";
    }

    function resetBag(){
      localStorage.setItem(LS_BAG, JSON.stringify(defaultBag));
      localStorage.setItem(LS_NAME, "é»˜è®¤ç­¾ç­’");
      saveTip.textContent = "å·²æ¢å¤é»˜è®¤ç­¾ã€‚";
      render();
    }
// ===== è‡ªå®šä¹‰ç­¾ç­’ï¼ˆæœ¬åœ°ä¿å­˜ï¼‰=====
const LS_CUSTOM_POOL = "sunmoon_custom_pool_v1";
const LS_POOL_MODE = "sunmoon_pool_mode_v1"; // "default" | "custom"

function parseLines(text){
  return text
    .split("\n")
    .map(s => s.trim())
    .filter(Boolean);
}

function loadCustomPool(){
  try{
    const raw = localStorage.getItem(LS_CUSTOM_POOL) || "";
    return parseLines(raw);
  }catch(e){
    return [];
  }
}

function saveCustomPool(lines){
  localStorage.setItem(LS_CUSTOM_POOL, lines.join("\n"));
}

function setPoolMode(mode){
  localStorage.setItem(LS_POOL_MODE, mode);
  const status = document.getElementById("customStatus");
  if(status) status.textContent = "å½“å‰ï¼š" + (mode === "custom" ? "è‡ªå®šä¹‰ç­¾ç­’" : "é»˜è®¤ç­¾ç­’");
}

// ä½ åŸæœ¬çš„ç­¾æ± å˜é‡ï¼Œå‡è®¾å« defaultBag / pool / items ä¹‹ç±»
// è¿™é‡Œéœ€è¦ä½ æŠŠâ€œå½“å‰ä½¿ç”¨çš„ç­¾æ± â€åˆ‡æ¢æ‰ã€‚
// æˆ‘å…ˆåšæˆï¼šcurrentPool æŒ‡å‘ä½ æŠ½ç­¾æ—¶ç”¨çš„æ•°ç»„ã€‚
let currentPool = null;

// è¿™æ®µä½ è¦å¯¹é½ä½ çš„åŸä»£ç ï¼šæŠŠâ€œæŠ½ç­¾ç”¨çš„æ•°ç»„â€æ”¹æˆ currentPool
function initPoolBridge(){
  // 1) æ‰¾åˆ°ä½ åŸæ¥é»˜è®¤ç­¾æ± æ•°ç»„ï¼ˆæ¯”å¦‚ defaultBag æˆ– defaultPoolï¼‰
  // 2) è®© currentPool = defaultPool
  // 3) æŠ½ç­¾å‡½æ•°ç”¨ currentPool
  //
  // å› ä¸ºæˆ‘æ²¡çœ‹åˆ°ä½ å…·ä½“å˜é‡åï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œåšâ€œæœ€å°‘ä¾µå…¥å¼â€å¤„ç†ï¼š
  // å¦‚æœä½ åŸæ¥å°±æœ‰ä¸€ä¸ªå…¨å±€æ•°ç»„å« defaultBagï¼Œå°±ç”¨å®ƒã€‚
  if(typeof defaultBag !== "undefined"){
    currentPool = defaultBag.slice();
  }else if(typeof defaultPool !== "undefined"){
    currentPool = defaultPool.slice();
  }else if(typeof pool !== "undefined"){
    currentPool = pool.slice();
  }
}

function applyPoolMode(){
  const input = document.getElementById("customInput");
  const mode = localStorage.getItem(LS_POOL_MODE) || "default";
  const custom = loadCustomPool();

  if(input){
    input.value = custom.join("\n");
  }

  if(mode === "custom" && custom.length > 0){
    currentPool = custom.slice();
    setPoolMode("custom");
  }else{
    // å›é»˜è®¤
    initPoolBridge();
    setPoolMode("default");
  }
}

// ç»‘å®šæŒ‰é’®
function bindCustomUI(){
  const input = document.getElementById("customInput");
  const btnSave = document.getElementById("btnSaveCustom");
  const btnUse = document.getElementById("btnUseCustom");
  const btnDef = document.getElementById("btnUseDefault");

  if(btnSave){
    btnSave.addEventListener("click", () => {
      const lines = parseLines(input ? input.value : "");
      saveCustomPool(lines);
      document.getElementById("customStatus").textContent =
        "å·²ä¿å­˜ï¼š" + lines.length + " æ¡ï¼ˆå½“å‰ä¸ä¸€å®šåœ¨ä½¿ç”¨ï¼‰";
    });
  }

  if(btnUse){
    btnUse.addEventListener("click", () => {
      const lines = loadCustomPool();
      if(lines.length === 0){
        document.getElementById("customStatus").textContent = "ä½ çš„è‡ªå®šä¹‰ç­¾ç­’æ˜¯ç©ºçš„ğŸ˜‘";
        return;
      }
      currentPool = lines.slice();
      setPoolMode("custom");
    });
  }

  if(btnDef){
    btnDef.addEventListener("click", () => {
      initPoolBridge();
      setPoolMode("default");
    });
  }
}

// é¡µé¢å¯åŠ¨
initPoolBridge();
bindCustomUI();
applyPoolMode();

    function drawOne(){
      const bag = getBag();
      const pick = bag[Math.floor(Math.random() * bag.length)];
      resultText.textContent = pick;
      resultMeta.textContent = "æŠ½åˆ°å°±ç®—æ•°ã€‚åæ‚”ä¹Ÿè¡Œï¼Œä½†è¦å¯¹è‡ªå·±å¥½ä¸€ç‚¹ã€‚";
      localStorage.setItem(LS_LAST, pick);
    }

    async function copyResult(){
      const text = (resultText.textContent || "").trim();
      if (!text || text === "ç‚¹â€œæŠ½ä¸€ç­¾â€") return;
      try{
        await navigator.clipboard.writeText(text);
        resultMeta.textContent = "å¤åˆ¶å¥½äº†ã€‚å»æ‰§è¡Œã€‚";
      }catch{
        resultMeta.textContent = "å¤åˆ¶å¤±è´¥ã€‚é•¿æŒ‰ä¹Ÿèƒ½å¤åˆ¶ã€‚";
      }
    }

    function clearLast(){
      localStorage.removeItem(LS_LAST);
      resultText.textContent = "ç‚¹â€œæŠ½ä¸€ç­¾â€";
      resultMeta.textContent = "æ¸…ç©ºå±•ç¤ºäº†ã€‚";
    }

    $("btnDraw").addEventListener("click", drawOne);
    $("btnCopy").addEventListener("click", copyResult);
    $("btnClearLast").addEventListener("click", clearLast);
    $("btnSave").addEventListener("click", saveBag);
    $("btnReset").addEventListener("click", resetBag);
$("btnSaveCustom").addEventListener("click", saveCustomBag);
$("btnUseCustom").addEventListener("click", () => { setPoolMode("custom"); render(); });
$("btnUseDefault").addEventListener("click", () => { setPoolMode("default"); render(); });
    render();
  </script>
</body>
</html>
